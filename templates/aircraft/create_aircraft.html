{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - Tivano{% endblock %}

{% block content %}
<!-- Nagłówek -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <h1 class="h3 mb-0">
            <i class="bi bi-airplane"></i> {{ title }}
        </h1>
        <a href="{% url 'aircraft_list' %}" class="btn btn-light">
            <i class="bi bi-arrow-left"></i> Powrót
        </a>
    </div>
</div>

<!-- Formularz -->
<form method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}

    <!-- Podstawowe dane -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="section-title">
                <i class="bi bi-info-circle"></i> Podstawowe informacje
            </div>

            <div class="row g-3">
                <!-- Producent -->
                <div class="col-md-6">
                    <label for="{{ form.manufacturer.id_for_label }}" class="form-label">
                        {{ form.manufacturer.label }} <span class="text-danger">*</span>
                    </label>
                    {{ form.manufacturer }}
                    {% if form.manufacturer.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.manufacturer.errors }}
                        </div>
                    {% endif %}
                </div>

                <!-- Typ samolotu -->
                <div class="col-md-6">
                    <label for="{{ form.aircraft_type.id_for_label }}" class="form-label">
                        {{ form.aircraft_type.label }} <span class="text-danger">*</span>
                    </label>
                    {{ form.aircraft_type }}
                    {% if form.aircraft_type.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.aircraft_type.errors }}
                        </div>
                    {% endif %}
                </div>

                <!-- S/N -->
                <div class="col-md-6">
                    <label for="{{ form.serial_number.id_for_label }}" class="form-label">
                        {{ form.serial_number.label }} <span class="text-danger">*</span>
                    </label>
                    {{ form.serial_number }}
                    {% if form.serial_number.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.serial_number.errors }}
                        </div>
                    {% endif %}
                </div>

                <!-- Znaki rejestracyjne -->
                <div class="col-md-6">
                    <label for="{{ form.registration_marks.id_for_label }}" class="form-label">
                        {{ form.registration_marks.label }} <span class="text-danger">*</span>
                    </label>
                    {{ form.registration_marks }}
                    {% if form.registration_marks.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.registration_marks.errors }}
                        </div>
                    {% endif %}
                </div>

                <!-- Zdjęcie samolotu -->
                <div class="col-md-12">
                    <label for="{{ form.photo.id_for_label }}" class="form-label">
                        {{ form.photo.label }}
                    </label>
                    {{ form.photo }}
                    {% if form.photo.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.photo.errors }}
                        </div>
                    {% endif %}
                    <div class="form-text">
                        <i class="bi bi-info-circle"></i> Dodaj zdjęcie samolotu (opcjonalnie)
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wartości bazowe -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="section-title">
                <i class="bi bi-speedometer"></i> Wartości początkowe
            </div>

            <div class="row g-3">
                <!-- Bazowa liczba godzin -->
                <div class="col-md-6">
                    <label for="{{ form.base_flight_hours.id_for_label }}" class="form-label">
                        {{ form.base_flight_hours.label }}
                    </label>
                    {{ form.base_flight_hours }}
                    {% if form.base_flight_hours.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.base_flight_hours.errors }}
                        </div>
                    {% endif %}
                    <div class="form-text">
                        <i class="bi bi-info-circle"></i> Wartość początkowa godzin nalotu (np. 1500.50 przy zakupie używanego samolotu)
                    </div>
                </div>

                <!-- Bazowa liczba lądowań -->
                <div class="col-md-6">
                    <label for="{{ form.base_landings.id_for_label }}" class="form-label">
                        {{ form.base_landings.label }}
                    </label>
                    {{ form.base_landings }}
                    {% if form.base_landings.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.base_landings.errors }}
                        </div>
                    {% endif %}
                    <div class="form-text">
                        <i class="bi bi-info-circle"></i> Wartość początkowa liczby lądowań (np. 2500 przy zakupie używanego samolotu)
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Obsługa techniczna -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="section-title">
                <i class="bi bi-tools"></i> Obsługa techniczna i certyfikaty
            </div>

            <div class="row g-3">
                <!-- Data następnej obsługi -->
                <div class="col-md-6">
                    <label for="{{ form.next_service_date.id_for_label }}" class="form-label">
                        {{ form.next_service_date.label }}
                    </label>
                    {{ form.next_service_date }}
                    {% if form.next_service_date.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.next_service_date.errors }}
                        </div>
                    {% endif %}
                </div>

                <!-- Motogodziny następnej obsługi -->
                <div class="col-md-6">
                    <label for="{{ form.next_service_hours.id_for_label }}" class="form-label">
                        {{ form.next_service_hours.label }}
                    </label>
                    {{ form.next_service_hours }}
                    {% if form.next_service_hours.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.next_service_hours.errors }}
                        </div>
                    {% endif %}
                    <small class="form-text text-muted">Liczba motogodzin do następnego przeglądu</small>
                </div>

                <!-- ARC -->
                <div class="col-md-6">
                    <label for="{{ form.arc_valid_until.id_for_label }}" class="form-label">
                        {{ form.arc_valid_until.label }}
                    </label>
                    {{ form.arc_valid_until }}
                    {% if form.arc_valid_until.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.arc_valid_until.errors }}
                        </div>
                    {% endif %}
                </div>

                <!-- OC -->
                <div class="col-md-6">
                    <label for="{{ form.insurance_valid_until.id_for_label }}" class="form-label">
                        {{ form.insurance_valid_until.label }}
                    </label>
                    {{ form.insurance_valid_until }}
                    {% if form.insurance_valid_until.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.insurance_valid_until.errors }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Status -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="form-check">
                {{ form.is_active }}
                <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                    {{ form.is_active.label }}
                </label>
                {% if form.is_active.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.is_active.errors }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Przyciski -->
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="{% url 'aircraft_list' %}" class="btn btn-secondary">
            <i class="bi bi-x-circle"></i> Anuluj
        </a>
        <button type="submit" class="btn btn-success btn-lg">
            <i class="bi bi-save"></i> Zapisz samolot
        </button>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
    // Uppercase dla znaków rejestracyjnych
    document.querySelector('input[name="registration_marks"]').addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase();
    });

    // Walidacja Bootstrap
    (function () {
        'use strict'
        const forms = document.querySelectorAll('form')
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
    })()
</script>
{% endblock %}
